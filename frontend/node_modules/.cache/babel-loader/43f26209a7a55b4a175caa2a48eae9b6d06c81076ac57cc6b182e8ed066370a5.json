{"ast":null,"code":"var _jsxFileName = \"/Users/parhamgolmohammadi/Sales/frontend/src/component/SecureImage.js\",\n  _s = $RefreshSig$();\n// frontend/src/component/SecureImage.js - QUICK FIX\n\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SecureImage = ({\n  receiptId,\n  alt,\n  className,\n  onClick,\n  style,\n  onError\n}) => {\n  _s();\n  const [imageUrl, setImageUrl] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    loadImage();\n\n    // Cleanup function to revoke object URL\n    return () => {\n      if (imageUrl && imageUrl.startsWith('blob:')) {\n        URL.revokeObjectURL(imageUrl);\n      }\n    };\n  }, [receiptId]);\n  const loadImage = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const token = localStorage.getItem('access_token');\n      if (!token) {\n        throw new Error('No authentication token');\n      }\n\n      // FIXED: Construct URL more carefully to avoid double slashes\n      const baseUrl = 'http://127.0.0.1:8000'; // Base URL without /api\n      const fullUrl = `${baseUrl}/api/receipts/${receiptId}/view/`;\n      console.log('üîç Loading image from URL:', fullUrl); // Debug log\n\n      const response = await fetch(fullUrl, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Accept': 'image/*,application/pdf,*/*'\n        },\n        credentials: 'include'\n      });\n      console.log('üì° Response status:', response.status, response.statusText); // Debug log\n\n      if (!response.ok) {\n        throw new Error(`Failed to load image: ${response.status} ${response.statusText}`);\n      }\n      const blob = await response.blob();\n      console.log('üì¶ Blob type:', blob.type, 'size:', blob.size); // Debug log\n\n      const objectUrl = URL.createObjectURL(blob);\n      setImageUrl(objectUrl);\n    } catch (err) {\n      console.error('‚ùå Error loading secure image:', err);\n      setError(err.message);\n      if (onError) {\n        onError(err);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `secure-image-loading ${className || ''}`,\n      style: style,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: '20px',\n          textAlign: 'center',\n          background: '#f3f4f6',\n          border: '2px solid #d1d5db',\n          borderRadius: '8px',\n          minHeight: '100px',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '24px',\n              marginBottom: '8px'\n            },\n            children: \"\\uD83D\\uDD04\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"\\u062F\\u0631 \\u062D\\u0627\\u0644 \\u0628\\u0627\\u0631\\u06AF\\u06CC\\u0631\\u06CC...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `secure-image-error ${className || ''}`,\n      style: style,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: '20px',\n          textAlign: 'center',\n          background: '#fef2f2',\n          border: '2px solid #fecaca',\n          borderRadius: '8px',\n          color: '#dc2626',\n          minHeight: '100px',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '24px',\n              marginBottom: '8px'\n            },\n            children: \"\\u274C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"\\u062E\\u0637\\u0627 \\u062F\\u0631 \\u0628\\u0627\\u0631\\u06AF\\u06CC\\u0631\\u06CC \\u062A\\u0635\\u0648\\u06CC\\u0631\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '12px',\n              marginTop: '4px'\n            },\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: loadImage,\n            style: {\n              marginTop: '8px',\n              padding: '4px 8px',\n              background: '#dc2626',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer'\n            },\n            children: \"\\u062A\\u0644\\u0627\\u0634 \\u0645\\u062C\\u062F\\u062F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"img\", {\n    src: imageUrl,\n    alt: alt,\n    className: className,\n    onClick: onClick,\n    style: style,\n    onError: e => {\n      console.error('‚ùå Image render error:', e);\n      setError('ÿÆÿ∑ÿß ÿØÿ± ŸÜŸÖÿß€åÿ¥ ÿ™ÿµŸà€åÿ±');\n      if (onError) {\n        onError(e);\n      }\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 9\n  }, this);\n};\n_s(SecureImage, \"Pj+Kn3ZWWkjxCIjInq3WSgZG7V0=\");\n_c = SecureImage;\nexport default SecureImage;\nvar _c;\n$RefreshReg$(_c, \"SecureImage\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","SecureImage","receiptId","alt","className","onClick","style","onError","_s","imageUrl","setImageUrl","loading","setLoading","error","setError","loadImage","startsWith","URL","revokeObjectURL","token","localStorage","getItem","Error","baseUrl","fullUrl","console","log","response","fetch","method","headers","credentials","status","statusText","ok","blob","type","size","objectUrl","createObjectURL","err","message","children","padding","textAlign","background","border","borderRadius","minHeight","display","alignItems","justifyContent","fontSize","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","color","marginTop","cursor","src","e","_c","$RefreshReg$"],"sources":["/Users/parhamgolmohammadi/Sales/frontend/src/component/SecureImage.js"],"sourcesContent":["// frontend/src/component/SecureImage.js - QUICK FIX\n\nimport React, { useState, useEffect } from 'react';\n\nconst SecureImage = ({ receiptId, alt, className, onClick, style, onError }) => {\n    const [imageUrl, setImageUrl] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        loadImage();\n\n        // Cleanup function to revoke object URL\n        return () => {\n            if (imageUrl && imageUrl.startsWith('blob:')) {\n                URL.revokeObjectURL(imageUrl);\n            }\n        };\n    }, [receiptId]);\n\n    const loadImage = async () => {\n        try {\n            setLoading(true);\n            setError(null);\n\n            const token = localStorage.getItem('access_token');\n            if (!token) {\n                throw new Error('No authentication token');\n            }\n\n            // FIXED: Construct URL more carefully to avoid double slashes\n            const baseUrl = 'http://127.0.0.1:8000'; // Base URL without /api\n            const fullUrl = `${baseUrl}/api/receipts/${receiptId}/view/`;\n\n            console.log('üîç Loading image from URL:', fullUrl); // Debug log\n\n            const response = await fetch(fullUrl, {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${token}`,\n                    'Accept': 'image/*,application/pdf,*/*',\n                },\n                credentials: 'include'\n            });\n\n            console.log('üì° Response status:', response.status, response.statusText); // Debug log\n\n            if (!response.ok) {\n                throw new Error(`Failed to load image: ${response.status} ${response.statusText}`);\n            }\n\n            const blob = await response.blob();\n            console.log('üì¶ Blob type:', blob.type, 'size:', blob.size); // Debug log\n\n            const objectUrl = URL.createObjectURL(blob);\n            setImageUrl(objectUrl);\n        } catch (err) {\n            console.error('‚ùå Error loading secure image:', err);\n            setError(err.message);\n            if (onError) {\n                onError(err);\n            }\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className={`secure-image-loading ${className || ''}`} style={style}>\n                <div style={{\n                    padding: '20px',\n                    textAlign: 'center',\n                    background: '#f3f4f6',\n                    border: '2px solid #d1d5db',\n                    borderRadius: '8px',\n                    minHeight: '100px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center'\n                }}>\n                    <div>\n                        <div style={{ fontSize: '24px', marginBottom: '8px' }}>üîÑ</div>\n                        <div>ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Ø€åÿ±€å...</div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <div className={`secure-image-error ${className || ''}`} style={style}>\n                <div style={{\n                    padding: '20px',\n                    textAlign: 'center',\n                    background: '#fef2f2',\n                    border: '2px solid #fecaca',\n                    borderRadius: '8px',\n                    color: '#dc2626',\n                    minHeight: '100px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center'\n                }}>\n                    <div>\n                        <div style={{ fontSize: '24px', marginBottom: '8px' }}>‚ùå</div>\n                        <div>ÿÆÿ∑ÿß ÿØÿ± ÿ®ÿßÿ±⁄Ø€åÿ±€å ÿ™ÿµŸà€åÿ±</div>\n                        <div style={{ fontSize: '12px', marginTop: '4px' }}>{error}</div>\n                        <button\n                            onClick={loadImage}\n                            style={{\n                                marginTop: '8px',\n                                padding: '4px 8px',\n                                background: '#dc2626',\n                                color: 'white',\n                                border: 'none',\n                                borderRadius: '4px',\n                                cursor: 'pointer'\n                            }}\n                        >\n                            ÿ™ŸÑÿßÿ¥ ŸÖÿ¨ÿØÿØ\n                        </button>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imageUrl}\n            alt={alt}\n            className={className}\n            onClick={onClick}\n            style={style}\n            onError={(e) => {\n                console.error('‚ùå Image render error:', e);\n                setError('ÿÆÿ∑ÿß ÿØÿ± ŸÜŸÖÿß€åÿ¥ ÿ™ÿµŸà€åÿ±');\n                if (onError) {\n                    onError(e);\n                }\n            }}\n        />\n    );\n};\n\nexport default SecureImage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}